{
    "app-id": "org.unknown_horizons.UnknownHorizons",
    "runtime": "org.freedesktop.Platform",
    "runtime-version": "23.08",
    "sdk": "org.freedesktop.Sdk",
    "command": "unknown-horizons",
    "rename-desktop-file": "unknown-horizons.desktop",
    "rename-appdata-file":  "unknown-horizons.appdata.xml",
    "rename-icon": "unknown-horizons",
    "finish-args": [
        "--share=ipc",
        "--device=dri",
        "--socket=wayland",
        "--socket=fallback-x11",
        "--socket=pulseaudio",
        "--share=network"
    ],
    "modules": [
        {
            "name": "fifechan",
            "buildsystem": "cmake-ninja",
            "builddir": true,
            "sources": [
                {
                    "type": "git",
                    "url": "https://github.com/fifengine/fifechan.git",
                    "tag": "0.1.5"
                }
            ]
        },
        {
            "name": "fifengine",
            "buildsystem": "cmake-ninja",
            "builddir": true,
            "config-opts": [
                "-Dcegui=OFF",
                "-DPYTHON_SITE_PACKAGES=${FLATPAK_DEST}/lib/python3.11/site-packages"
            ],
            "modules": [
                {
                    "name": "tinyxml",
                    "buildsystem": "meson",
                    "sources": [
                        {
                            "type": "git",
                            "url": "https://github.com/tintou/tinyxml.git",
                            "commit": "852527eb49a449599806d4671bb27a79fe0fbf16"
                        }
                    ]
                },
                "shared-modules/glew/glew.json",
                "shared-modules/glu/glu-9.json",
                {
                    "name": "boost",
                    "buildsystem": "simple",
                    "build-commands": [
                        "./bootstrap.sh variant=release debug-symbols=on --prefix=${FLATPAK_DEST} --with-libraries=filesystem,system",
                        "./b2 -j $FLATPAK_BUILDER_N_JOBS install"
                    ],
                    "sources": [
                        {
                            "type": "archive",
                            "url": "https://boostorg.jfrog.io/artifactory/main/release/1.83.0/source/boost_1_83_0.tar.bz2",
                            "sha256": "6478edfe2f3305127cffe8caf73ea0176c53769f4bf1585be237eb30798c3b8e"
                        }
                    ]
                },
                {
                    "name": "swig",
                    "config-opts": [
                        "--without-pcre",
                        "--without-alllang"
                    ],
                    "cleanup": [
                        "/share/swig"
                    ],
                    "sources": [
                        {
                            "type": "archive",
                            "url": "https://sourceforge.net/projects/swig/files/swig/swig-4.1.1/swig-4.1.1.tar.gz",
                            "sha256": "2af08aced8fcd65cdb5cc62426768914bedc735b1c250325203716f78e39ac9b"
                        }
                    ]
                }
            ],
            "sources": [
                {
                    "type": "git",
                    "buildsystem": "cmake-ninja",
                    "url": "https://github.com/fifengine/fifengine.git",
                    "commit": "f37c31c6cea74d50f1d635d876253a7b1f64630b"
                }
            ]
        },
        {
            "name": "python3-distro",
            "buildsystem": "simple",
            "build-commands": [
                "pip3 install --exists-action=i --no-index --find-links=\"file://${PWD}\" --prefix=${FLATPAK_DEST} \"distro\""
            ],
            "sources": [
                {
                    "type": "file",
                    "url": "https://files.pythonhosted.org/packages/f4/2c/c90a3adaf0ddb70afe193f5ebfb539612af57cffe677c3126be533df3098/distro-1.8.0-py3-none-any.whl",
                    "sha256": "99522ca3e365cac527b44bde033f64c6945d90eb9f769703caaec52b09bbd3ff"
                }
            ]
        },
        "shared-modules/intltool/intltool-0.51.json",
        {
            "name": "tkinter",
            "buildsystem": "simple",
            "build-commands": [
                "pip3 install --prefix=${FLATPAK_DEST} ."
            ],
            "sources": [
                {
                    "type": "git",
                    "url": "https://github.com/iwalton3/tkinter-standalone",
                    "commit": "20950173c51b7d4b67cfb5d765d41c2600f9bee3"
                }
            ],
            "modules": [
                {
                    "name": "tcl8.6",
                    "sources": [
                        {
                            "type": "archive",
                            "url": "https://prdownloads.sourceforge.net/tcl/tcl8.6.13-src.tar.gz",
                            "sha256": "43a1fae7412f61ff11de2cfd05d28cfc3a73762f354a417c62370a54e2caf066"
                        }
                    ],
                    "subdir": "unix",
                    "post-install": [
                        "chmod +w ${FLATPAK_DEST}/lib/libtcl8.6.so"
                    ]
                },
                {
                    "name": "tk8.6",
                    "sources": [
                        {
                            "type": "archive",
                            "url": "https://prdownloads.sourceforge.net/tcl/tk8.6.13-src.tar.gz",
                            "sha256": "2e65fa069a23365440a3c56c556b8673b5e32a283800d8d9b257e3f584ce0675"
                        }
                    ],
                    "subdir": "unix",
                    "post-install": [
                        "chmod +w ${FLATPAK_DEST}/lib/libtk8.6.so"
                    ]
                }
            ]
        },
        {
            "name": "python-future",
            "buildsystem": "simple",
            "build-commands": [
                "pip3 install --no-index --find-links=\"file://${PWD}\" --prefix=${FLATPAK_DEST} future"
            ],
            "sources": [
                {
                    "type": "file",
                    "url": "https://files.pythonhosted.org/packages/8f/2e/cf6accf7415237d6faeeebdc7832023c90e0282aa16fd3263db0eb4715ec/future-0.18.3.tar.gz",
                    "sha256": "34a17436ed1e96697a86f9de3d15a3b0be01d8bc8de9c1dffd59fb8234ed5307"
                }
            ]
        },
        {
            "name" : "PyYAML",
            "buildsystem" : "simple",
            "build-commands" : [
                "python3 setup.py install --prefix=${FLATPAK_DEST} --root=/"
            ],
            "sources" : [
                {
                    "type" : "archive",
                    "url" : "https://files.pythonhosted.org/packages/cd/e5/af35f7ea75cf72f2cd079c95ee16797de7cd71f29ea7c68ae5ce7be1eda0/PyYAML-6.0.1.tar.gz",
                    "sha256" : "bfdf460b1736c775f2ba9f6a92bca30bc2095067b8a9d77876d1fad6cc3b4a43"
                }
            ]
        },
        {
            "name" : "python3-lib2to3",
            "buildsystem": "simple",
            "build-commands": [
                "cp -r Lib/lib2to3 ${FLATPAK_DEST}/lib/python3.11/site-packages/"
            ],
            "sources" : [
                {
                    "type" : "archive",
                    "url" : "https://www.python.org/ftp/python/3.11.5/Python-3.11.5.tgz",
                    "sha256" : "a12a0a013a30b846c786c010f2c19dd36b7298d888f7c4bd1581d90ce18b5e58"
                }
            ]
        },
        {
            "name": "unknown-horizons",
            "buildsystem": "simple",
            "build-commands": [
                "python3 setup.py build_i18n",
                "python3 setup.py install --prefix=${FLATPAK_DEST}",
                "mkdir -p ${FLATPAK_DEST}/share/icons/hicolor/scalable/apps/",
                "install -m 644 -p content/gui/images/logos/uh_no_text.svg ${FLATPAK_DEST}/share/icons/hicolor/scalable/apps/unknown-horizons.svg",
                "mkdir -p ${FLATPAK_DEST}/share/metainfo/",
                "install -m 644 -p content/packages/unknown-horizons.appdata.xml ${FLATPAK_DEST}/share/metainfo/",
                "RELEASE_VERSION=\"2019.1+$(git rev-parse --short HEAD)\" && sed -i \"s/RELEASE_VERSION = get_git_version()/RELEASE_VERSION = \\\"$RELEASE_VERSION\\\"/\" ${FLATPAK_DEST}/lib/python3.11/site-packages/horizons/constants.py"
            ],
            "sources": [
                {
                    "type": "git",
                    "url": "https://github.com/unknown-horizons/unknown-horizons.git",
                    "commit": "d106648463a391a86779b63a2e643ea8301f2683"
                }
            ]
        }
    ]
}
